$(function(){if(!("getContext"in document.createElement("canvas")))return alert("Sorry, it looks like your browser does not support canvas!"),!1;var t="http://"+window.location.hostname+":"+window.location.port,p=$(document);$(window);var q=$("#paper"),e=q[0].getContext("2d"),u=$("#instructions"),r=$("#color"),f=$("#log"),b=$("#message"),c=$("#nickname"),g=$("#login"),h=$("#submit"),v=Math.round($.now()*Math.random());$.cookie("nickname")?(name=$.cookie("nickname"),b.show("fast"),h.show("fast")):
(c.show("fast"),g.show("fast"));var j=!1,d={},k={},l=io.connect(t),i=1;l.on("moving",function(a){a.id in d||(k[a.id]=$('<div class="cursor">').appendTo("#cursors"),i++,$("#count").text(i+" Users Online"));k[a.id].css({left:a.x,top:a.y});if(a.drawing&&d[a.id]){var b=d[a.id].x,c=d[a.id].y,f=a.x,g=a.y,h=a.color;e.beginPath();e.moveTo(b,c);e.lineTo(f,g);e.strokeStyle=h;e.stroke()}d[a.id]=a;d[a.id].updated=$.now()});var m,n;q.on("mousedown",function(a){a.preventDefault();j=!0;m=a.pageX;n=a.pageY;u.fadeOut()});
p.bind("mouseup mouseleave",function(){j=!1});var s=$.now();p.on("mousemove",function(a){5<$.now()-s&&(l.emit("mousemove",{x:a.pageX,y:a.pageY,drawing:j,id:v,color:r.val()}),s=$.now());if(j){var b=m,c=n,d=a.pageX,f=a.pageY,g=r.val();e.beginPath();e.moveTo(b,c);e.lineTo(d,f);e.strokeStyle=g;e.stroke();m=a.pageX;n=a.pageY}});setInterval(function(){for(ident in d)1E4<$.now()-d[ident].updated&&(k[ident].remove(),delete d[ident],delete k[ident],i--,1==i?$("#count").text(i+" User Online"):$("#count").text(i+
" Users Online"))},1E3);l.on("message",function(a){f.append("<li><strong>"+a.username+":</strong> "+a.msg+"</li>");f.scrollTop(1E10)});b.keypress(function(a){13==a.keyCode&&(""==b.val()?alert("Message cannot be empty!"):(l.emit("send",{username:name,msg:b.val()}),f.append("<li><strong>"+name+":</strong> "+b.val()+"</li>"),b.val(""),f.scrollTop(1E10)))});g.click(function(){""==c.val()?alert("Nickname cannot be empty!"):($.cookie("nickname",c.val(),{expires:1}),name=c.val(),g.hide("fast"),c.hide("fast"),
b.show("fast"),h.show("fast"))});h.click(function(){$.removeCookie("nickname");c.val("");name="";b.hide("fast");h.hide("fast");g.show("fast");c.show("fast")})});